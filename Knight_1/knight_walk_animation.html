<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Knight Animations</title>
<style>
  body {
    background: #222;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }

  .knight {
    width: 128px; /* Frame width */
    height: 128px; /* Frame height */
    background-repeat: no-repeat;
    transform: scale(3);
    image-rendering: pixelated;
    /* The animation property will be set by JavaScript */
  }

  /* Animation Classes */
  .walk { background-image: url('Walk.png'); }
  .attack1 { background-image: url('Attack 1.png'); }
  .attack2 { background-image: url('Attack 2.png'); }
  .attack3 { background-image: url('Attack 3.png'); }
  .dead { background-image: url('Dead.png'); }
  .defend { background-image: url('Defend.png'); }
  .hurt { background-image: url('Hurt.png'); }
  .idle { background-image: url('Idle.png'); }
  .jump { background-image: url('Jump.png'); }
  .run { background-image: url('Run.png'); }
  .run-attack { background-image: url('Run+Attack.png'); }

  /* Keyframes for different frame counts */
  @keyframes sprite-2-frames { to { background-position: -256px 0; } }
  @keyframes sprite-4-frames { to { background-position: -512px 0; } }
  @keyframes sprite-5-frames { to { background-position: -640px 0; } }
  @keyframes sprite-6-frames { to { background-position: -768px 0; } }
  @keyframes sprite-7-frames { to { background-position: -896px 0; } }
  @keyframes sprite-8-frames { to { background-position: -1024px 0; } }

</style>
</head>
<body>
  <div class="knight"></div>

  <script>
    const knightElement = document.querySelector('.knight');
    let currentAnimationIndex = 0;

    // Array describing all animations
    const animations = [
      { name: 'walk', frames: 8, duration: 1.0 },
      { name: 'run', frames: 7, duration: 0.8 },
      { name: 'idle', frames: 4, duration: 1.5 },
      { name: 'attack1', frames: 5, duration: 0.6 },
      { name: 'attack2', frames: 4, duration: 0.6 },
      { name: 'attack3', frames: 4, duration: 0.8 },
      { name: 'run-attack', frames: 6, duration: 0.8 },
      { name: 'jump', frames: 6, duration: 1.2 },
      { name: 'defend', frames: 5, duration: 1 },
      { name: 'hurt', frames: 2, duration: 0.5 },
      { name: 'dead', frames: 6, duration: 1.5 },
    ];

    function playNextAnimation() {
      // Get the current animation details
      const animation = animations[currentAnimationIndex];
      
      // 1. Reset all animation properties and classes
      knightElement.style.animation = 'none';
      knightElement.className = 'knight'; // Keep only the base class
      
      // 2. Use requestAnimationFrame to ensure the reset is processed before starting the new animation
      requestAnimationFrame(() => {
        // 3. Set the new animation properties
        const animationName = `sprite-${animation.frames}-frames`;
        const animationDuration = `${animation.duration}s`;
        const timingFunction = `steps(${animation.frames})`;
        knightElement.style.animation = `${animationName} ${animationDuration} ${timingFunction} 1`;
        knightElement.classList.add(animation.name);
      });
    }

    // Listen for the end of an animation
    knightElement.addEventListener('animationend', () => {
      // Move to the next animation, or loop back to the start
      currentAnimationIndex++;
      if (currentAnimationIndex >= animations.length) {
        currentAnimationIndex = 0;
      }
      playNextAnimation();
    });

    // Start the first animation
    playNextAnimation();
  </script>
</body>
</html>
