# Menu.js Refactoring Plan - UPDATED - Step by Step

## üéØ **–ì–õ–ê–í–ù–ê –¶–ï–õ: –ï–õ–ò–ú–ò–ù–ò–†–ê–ù–ï –ù–ê –ö–û–î –î–£–ë–õ–ò–†–ê–ù–ï–¢–û**
**–ö—Ä–∏—Ç–∏—á–µ–Ω –ø—Ä–æ–±–ª–µ–º:** –ù–æ–≤–∏—Ç–µ –º–æ–¥—É–ª–Ω–∏ —Ñ–∞–π–ª–æ–≤–µ —Å–∞ —Å—ä–∑–¥–∞–¥–µ–Ω–∏, –Ω–æ –æ—Ä–∏–≥–∏–Ω–∞–ª–Ω–∏—è—Ç `menu.js` –≤—Å–µ –æ—â–µ —Å—ä–¥—ä—Ä–∂–∞ 2000+ —Ä–µ–¥–∞ –¥—É–±–ª–∏—Ä–∞–Ω –∫–æ–¥. **–¢–æ–≤–∞ –µ –æ—Å–Ω–æ–≤–Ω–∏—è—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç!**

## üî• **–ù–û–í–ò –ò–ó–ò–°–ö–í–ê–ù–ò–Ø –ò –¶–ï–õ–ò**

### **–û—Å–Ω–æ–≤–Ω–∞ —Ü–µ–ª:**
- **–ï–ª–∏–º–∏–Ω–∏—Ä–∞–Ω–µ –Ω–∞ –¥—É–±–ª–∏—Ä–∞–Ω–∞ –ª–æ–≥–∏–∫–∞** - –µ–¥–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è/–ø—Ä–æ–º–µ–Ω–ª–∏–≤–∞ –Ω–∞ –µ–¥–Ω–æ –º—è—Å—Ç–æ
- **–ú–∞—Ä–∫–∏—Ä–∞–Ω–µ –∫—ä–¥–µ –µ –ø—Ä–µ–º–µ—Å—Ç–µ–Ω–∞ –ª–æ–≥–∏–∫–∞—Ç–∞** –≤ —Å—Ç–∞—Ä–∏—è —Ñ–∞–π–ª
- **–°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ Character System** –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –∑–∞ character-related –º–µ—Ö–∞–Ω–∏–∫–∏
- **–ü—ä–ª–Ω–æ –ø—Ä–µ–º–∞—Ö–≤–∞–Ω–µ** –Ω–∞ —Å—Ç–∞—Ä–∏—è `menu.js` —Å–ª–µ–¥ —É—Å–ø–µ—à–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è

### **–ö—Ä–∏—Ç–∏—á–Ω–æ –ø—Ä–∞–≤–∏–ª–æ:**
- **–ù–ï —Å–µ –¥–æ–ø—É—Å–∫–∞ –¥—É–±–ª–∏—Ä–∞–Ω–∞ –ª–æ–≥–∏–∫–∞** - —Ç–æ–≤–∞ –µ –æ—Å–Ω–æ–≤–Ω–∞—Ç–∞ —Ü–µ–ª –Ω–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ —Å–ø–æ—Ä–µ–¥ `refactoring-rules.md`
- **–í—Å–µ–∫–∏ —Ä–µ–¥ –∫–æ–¥** —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–º–∞ —Ç–æ—á–Ω–æ –µ–¥–Ω–æ –º—è—Å—Ç–æ –≤ –ø—Ä–æ–µ–∫—Ç–∞

## üìã **–¢–µ–∫—É—â —Å—Ç–∞—Ç—É—Å - –ü–†–û–ë–õ–ï–ú–ï–ù**
- ‚úÖ **Menu System —Å—ä–∑–¥–∞–¥–µ–Ω** - 10 –º–æ–¥—É–ª–Ω–∏ —Ñ–∞–π–ª–∞ –≤ `Menu System/`
- ‚ùå **–ö–æ–¥ –¥—É–±–ª–∏—Ä–∞–Ω** - –æ—Ä–∏–≥–∏–Ω–∞–ª–Ω–∏—è—Ç `menu.js` –≤—Å–µ –æ—â–µ –∏–º–∞ —Ü—è–ª–∞—Ç–∞ –ª–æ–≥–∏–∫–∞
- ‚ùå **Character System –Ω–µ –µ —Å—ä–∑–¥–∞–¥–µ–Ω** - `character_info.js`, `character_stats_ui.js` –≤ root
- ‚ùå **–ù–µ—è—Å–Ω–æ –∫–æ–π –∫–æ–¥ —Ä–∞–±–æ—Ç–∏** - –¥–≤–æ–π–Ω–∏ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–∏ –Ω–∞ –µ–¥–Ω–∏ –∏ —Å—ä—â–∏ —Ñ—É–Ω–∫—Ü–∏–∏

## üìù **–ù–û–í –ü–û–î–†–û–ë–ï–ù –ü–õ–ê–ù - –ü–†–ò–û–†–ò–¢–ï–¢–ò**

### **–§–∞–∑–∞ 0: –ö—Ä–∏—Ç–∏—á–µ–Ω Cleanup** üî• **[–ù–û–í - –ù–ê–ô-–í–ò–°–û–ö –ü–†–ò–û–†–ò–¢–ï–¢]**
- [x] **–ê–Ω–∞–ª–∏–∑–∏—Ä–∞–π –∫–∞–∫–≤–æ –µ –¥—É–±–ª–∏—Ä–∞–Ω–æ** –≤ `menu.js`
- [x] **–ú–∞—Ä–∫–∏—Ä–∞–π –≤—Å—è–∫–∞ –ø—Ä–µ–º–µ—Å—Ç–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è** —Å –∫–æ–º–µ–Ω—Ç–∞—Ä–∏ –≤ `menu.js`
- [ ] **–ü—Ä–µ–º–∞—Ö–Ω–∏ –¥—É–±–ª–∏—Ä–∞–Ω–∏—è –∫–æ–¥** —Å–µ–∫—Ü–∏—è –ø–æ —Å–µ–∫—Ü–∏—è
- [ ] **Test-–≤–∞–π** —á–µ –Ω–æ–≤–∞—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∏ –±–µ–∑ —Å—Ç–∞—Ä–∏—è –∫–æ–¥

### **–§–∞–∑–∞ 1: Character System —Å—ä–∑–¥–∞–≤–∞–Ω–µ** ‚úÖ **[–í–¢–û–†–ò –ü–†–ò–û–†–ò–¢–ï–¢]**
- [x] –°—ä–∑–¥–∞–π `Character System/` –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- [x] –ü—Ä–µ–º–µ—Å—Ç–∏ `character_info.js` ‚Üí `Character System/core/character_info.js`
- [x] –ü—Ä–µ–º–µ—Å—Ç–∏ `character_stats_ui.js` ‚Üí `Character System/ui/character_stats_ui.js`
- [x] –°—ä–∑–¥–∞–π `Character System/index.js` - –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä
- [x] –°—ä–∑–¥–∞–π `Character System/progression/experience_system.js` - XP –ª–æ–≥–∏–∫–∞
- [x] –°—ä–∑–¥–∞–π `Character System/progression/stat_distribution.js` - stat management
- [x] –°—ä–∑–¥–∞–π `Character System/combat/character_combat.js` - combat integration

### **–§–∞–∑–∞ 2: Integration –∏ testing** ‚úÖ
- [ ] Update `main.js` –¥–∞ –∏–∑–ø–æ–ª–∑–≤–∞ –Ω–æ–≤–∞—Ç–∞ `Menu System`
- [ ] Update `game.js` –¥–∞ –∏–∑–ø–æ–ª–∑–≤–∞ –Ω–æ–≤–∞—Ç–∞ —Å–∏—Å—Ç–µ–º–∞
- [ ] Test –æ—Å–Ω–æ–≤–Ω–∞—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç (menu show/hide)
- [ ] Test controls —Å–∏—Å—Ç–µ–º–∞
- [ ] Test skill tree —Å–∏—Å—Ç–µ–º–∞
- [ ] Test character stats

### **–§–∞–∑–∞ 3: –§–∏–Ω–∞–ª–Ω–æ cleanup** ‚úÖ
- [ ] **–ü–†–ï–ú–ê–•–ù–ò** —Å—Ç–∞—Ä–∏—è `menu.js` —Ñ–∞–π–ª –Ω–∞–ø—ä–ª–Ω–æ
- [ ] **–ü–†–ï–ú–ê–•–ù–ò** —Å—Ç–∞—Ä–∏—Ç–µ `character_info.js`, `character_stats_ui.js`
- [ ] Update –≤—Å–∏—á–∫–∏ imports –≤ –ø—Ä–æ–µ–∫—Ç–∞
- [ ] Test –ø—ä–ª–Ω–∞—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç
- [ ] Update –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è—Ç–∞

## üîç **–ö—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–Ω–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**

### **main.js updates needed:**
```javascript
// OLD
import './menu.js';

// NEW
import { initMenu } from './Menu System/index.js';
```

### **game.js updates needed:**
```javascript
// OLD
window.toggleMenu = toggleMenu;
window.MenuSystem = { handleSkillTreeKeys, handleCharacterStatsKeys, lastSkillTreeToggleTime };

// NEW
// Menu system is now self-contained, no global exports needed from game.js
```

### **HTML updates needed:**
```html
<!-- OLD -->
<script src="menu.js"></script>

<!-- NEW -->
<script type="module" src="Menu System/index.js"></script>
```

## ‚ö†Ô∏è **–†–∏—Å–∫–∏ –∏ –ø—Ä–µ–¥–ø–∞–∑–Ω–∏ –º–µ—Ä–∫–∏**

### **–†–∏—Å–∫: Global dependencies**
- **–ü—Ä–æ–±–ª–µ–º:** –ö–æ–¥—ä—Ç —Ä–∞–∑—á–∏—Ç–∞ –Ω–∞ –º–Ω–æ–≥–æ `window.*` globals
- **–†–µ—à–µ–Ω–∏–µ:** –ù–æ–≤–∞—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –∏–∑–ø–æ–ª–∑–≤–∞ parameter-based functions –∏ dependency injection

### **–†–∏—Å–∫: HTML structure changes**
- **–ü—Ä–æ–±–ª–µ–º:** Menu HTML —Å–µ –≥–µ–Ω–µ—Ä–∏—Ä–∞ dynamically
- **–†–µ—à–µ–Ω–∏–µ:** `menu_ui.js` —Å—ä–¥—ä—Ä–∂–∞ –≤—Å–∏—á–∫–∏ HTML templates

### **–†–∏—Å–∫: Character stats integration**
- **–ü—Ä–æ–±–ª–µ–º:** Character stats —Å–∞ –æ—Ç–¥–µ–ª–Ω–∞ —Å–∏—Å—Ç–µ–º–∞
- **–†–µ—à–µ–Ω–∏–µ:** Character System —â–µ –±—ä–¥–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–∞–Ω–∞ –∫–∞—Ç–æ external dependency

### **–†–∏—Å–∫: Skill tree complexity**
- **–ü—Ä–æ–±–ª–µ–º:** Skill tree –∏–º–∞ –º–Ω–æ–≥–æ –ª–æ–≥–∏–∫–∞ (grids, connections, micro trees)
- **–†–µ—à–µ–Ω–∏–µ:** –†–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ core (–ª–æ–≥–∏–∫–∞) + ui (—Ä–µ–Ω–¥–µ—Ä–∏—Ä–∞–Ω–µ) + helpers (shared)

## üìä **–û—á–∞–∫–≤–∞–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏**

- **–ü—Ä–µ–¥–∏:** 1 —Ñ–∞–π–ª, 2000+ —Ä–µ–¥–∞, —Å–º–µ—Å–µ–Ω–∏ –æ—Ç–≥–æ–≤–æ—Ä–Ω–æ—Å—Ç–∏
- **–°–ª–µ–¥:** 12+ —Ñ–∞–π–ª–∞, ~200-300 —Ä–µ–¥–∞ –≤—Å–µ–∫–∏, —è—Å–Ω–∏ –æ—Ç–≥–æ–≤–æ—Ä–Ω–æ—Å—Ç–∏
- **–ü–æ–ª–∑–∏:** –ü–æ–¥–¥—Ä—ä–∂–∫–∞, testing, scalability, developer experience

## üéØ **–°–ª–µ–¥–≤–∞—â–∏ —Å—Ç—ä–ø–∫–∏**

1. **–ü—Ä–æ–¥—ä–ª–∂–∏ —Å –§–∞–∑–∞ 2** - skill_helpers.js –∏ skill_tree_core.js
2. **Test –≤—Å—è–∫–∞ —Å—Ç—ä–ø–∫–∞** - –Ω–µ –ø—Ä–æ–¥—ä–ª–∂–∞–≤–∞–π –∞–∫–æ –Ω–µ —Ä–∞–±–æ—Ç–∏
3. **Update –ø–ª–∞–Ω–∞** - –º–∞—Ä–∫–∏—Ä–∞–π –∑–∞–≤—ä—Ä—à–µ–Ω–∏—Ç–µ —Å—Ç—ä–ø–∫–∏
4. **Commit —á–µ—Å—Ç–æ** - –≤—Å—è–∫–∞ —Ä–∞–±–æ—Ç–µ—â–∞ —Ñ–∞–∑–∞ –≤ –æ—Ç–¥–µ–ª–µ–Ω commit

---
*Plan created: 23.01.2026*
*Next phase: Skill tree —Å–∏—Å—Ç–µ–º–∞*
